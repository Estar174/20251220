<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ğŸ‰ ç”Ÿæ—¥å¿«ä¹ ğŸ‰</title>
    <style>
        body{
          margin:0;
          overflow:hidden;
          background-color: #f4f1ea;
          background-image: linear-gradient(rgba(0,0,0,0.02) 1px, transparent 1px);
          background-size: 100% 2.4em;
          font-family: "STKaiti", "KaiTi", "æ¥·ä½“", serif;
        }

        canvas {
          display: block;
          position: fixed;
          top: 0;
          left: 0;
          z-index: 10;
          pointer-events: none;
        }

        /* ç»™ä½ çš„å°ä¿¡ */
        #text-area {
          position: fixed;
          top: 8%;
          left: 50%;
          transform: translateX(-50%);
          width: 85%;
          max-width: 700px;
          color: #332f2a;
          z-index: 5;
          padding: 30px 40px;
          background: rgba(255, 255, 255, 0.4);
          box-shadow: 0 10px 30px rgba(0,0,0,0.05);
          border-radius: 4px;
          max-height: 80vh;
          overflow-y: auto;
        }

        #title-header {
          font-size: 32px;
          text-align: center;
          margin-bottom: 20px;
          display: block;
          color: #a94442;
          border-bottom: 2px solid #a94442;
          padding-bottom: 10px;
          font-weight: bold;
        }

        #content {
          font-size: 16px;
          line-height: 2.4;
          letter-spacing: 1px;
          white-space: pre-wrap;
          text-indent: 2em;
        }

        #letter-footer {
          text-align: right;
          margin-top: 40px;
          font-size: 15px;
          border-top: 1px dashed #ccc;
          padding-top: 15px;
        }

        #music{
          position:fixed;
          right:20px;
          bottom:20px;
          color:#fff;
          background-color: #a94442; /* æ”¹ä¸ºæ˜¾çœ¼çš„é¢œè‰² */
          font-size:14px;
          cursor:pointer;
          z-index: 100;
          border: none;
          padding: 8px 15px;
          border-radius: 20px;
          box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* ç…§ç‰‡å¼¹å‡º */
        #viewer{
          position:fixed;
          inset:0;
          display:flex;
          align-items:center;
          justify-content:center;
          pointer-events:none;
          z-index: 50;
        }
        .card{
          background:#fff;
          border-radius:8px;
          padding:12px;
          max-width:80vw;
          box-shadow:0 15px 50px rgba(0,0,0,0.2);
          opacity:0;
          transform:scale(.7) rotate(-2deg);
          transition:.5s cubic-bezier(0.175, 0.885, 0.32, 1.2);
        }
        .card.active{
          opacity:1;
          transform:scale(1) rotate(0deg);
          pointer-events:auto;
        }
        .card img{
          max-width:100%;
          max-height:55vh;
          border-radius:4px;
          display:block;
        }
        .card p{
          color:#555;
          text-align:center;
          margin:15px 0 5px;
          font-size: 16px;
          font-style: italic;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>

<div id="text-area">
    <span id="title-header"></span>
    <div id="content"></div>
    <div id="letter-footer">
        è§å­—å¦‚é¢ï¼Œçˆ±ä½ ã€‚<br>
        2025å¹´ ä»²å†¬
    </div>
</div>

<button id="music">ğŸµ æ’­æ”¾</button>

<div id="viewer">
    <div class="card" id="card">
        <img id="card-img" src="">
        <p id="card-text"></p>
    </div>
</div>

<audio id="bgm" loop>
    <source src="music/4H3PQa.mp3" type="audio/mpeg">
</audio>

<script>
    /* é…ç½® */
    const TITLE = "ğŸ‰ ç”Ÿæ—¥å¿«ä¹å®å® ğŸ‰";
    const MESSAGE = `äº²çˆ±çš„å®å®è€å©†

    ç”Ÿæ—¥å¿«ä¹ï¼è¿™æ˜¯æˆ‘å‚ä¸ä½ çš„ç¬¬äºŒä¸ªç”Ÿæ—¥ï¼Œç¿»äº†ç¿»æˆ‘ä»¬çš„ç…§ç‰‡ï¼Œè¯´å¾ˆå¤šçš„è¯ä¹Ÿä¸æ˜¯å¾ˆå¤šï¼Œä½†è¿™äº›éƒ½æ‰¿è½½ç€æˆ‘ä»¬åœ¨ä¸€èµ·å¼€å¿ƒçš„è¯æ˜ï¼Œè¿™äº›å¹³æ·¡çš„ç¬é—´ï¼Œéƒ½æ˜¯æˆ‘æœ€çè´µçš„å®è—ã€‚

    çºµä½¿æˆ‘ä»¬æœ‰äº›å°äº‰åµå°æ‹Œå˜´ï¼Œç¿»ä¸€ç¿»ç…§ç‰‡ï¼Œç¿»ä¸€ç¿»ä½ å†™ç»™æˆ‘çš„ä¸œè¥¿ï¼Œéƒ½çƒŸæ¶ˆäº‘æ•£å•¦ï¼å®å®æ°¸è¿œæ˜¯å®å®ï¼Œå®å®æ°¸è¿œæœ€æœ€æ£’ï¼

    ä½ å¯ä»¥è¯•ç€ç‚¹ä¸€ç‚¹çˆ±å¿ƒï¼Œæœ‰æƒŠå–œå˜¿å˜¿ï¼Œæˆ‘çš„æŠ€æœ¯æœ‰é™ï¼Œé‡Œé¢æ”¾ä¸äº†å¤ªå¤šä¸œè¥¿ï¼Œä¹Ÿæ”¾ä¸ä¸‹å¤ªå¤šå­—ï¼Œä¸è¿‡æˆ‘è¿™ä¸ªè¿˜æ˜¯å¯ä»¥å§å˜¿å˜¿ï¼Œç¥æˆ‘çš„å®å®è€å©†ç”Ÿæ—¥å¿«ä¹ï¼æ„¿æˆ‘ä»¬å²å²å¹³å®‰ï¼çˆ±ä½ ï¼
    `;

    const PHOTOS = [
      {url: "images/1.jpg",  text: "ç›¸è§å¦‚åˆè§ã€‚"},
      {url: "images/2.jpg",  text: "ç”Ÿæ´»å‹ä¸è·¨æˆ‘ä»¬çš„ï¼"},
      {url: "images/3.jpg",  text: "æ„¿å®å®å¤©å¤©å¼€å¿ƒï¼"},
      {url: "images/4.jpg",  text: "æˆ‘å®£å¸ƒï¼è¿™æ˜¯æˆ‘æœ€æœ€å¯çˆ±çš„å®å®ï¼"},
      {url: "images/5.jpg",  text: "æ„¿å®å®æœ‰ä¸€ä¸ªç¾å¥½çš„ç”Ÿæ—¥æ„¿æœ›ã€‚"},
      {url: "images/6.jpg",  text: "æˆ‘å–œæ¬¢ä½ çš„æ——è¢ã€‚"},
      {url: "images/7.jpg",  text: "èŠ±ä¹Ÿèƒœä¸äº†ä½ çš„ç¾ã€‚"},
      {url: "images/8.jpg",  text: "çŠ¹æŠ±çµç¶åŠé®é¢ã€‚"},
      {url: "images/9.jpg",  text: "å¯å¯çˆ±çˆ±ï¼Œæ½‡æ½‡æ´’æ´’ã€‚"},
      {url: "images/10.jpg", text: "æ„¿æˆ‘ä»¬ä¸€ç›´å¥½ã€‚"},
      {url: "images/11.jpg", text: "è¿™æ˜¯æˆ‘æœ€æƒ³è§åˆ°ä½ çš„æ ·å­ã€‚"},
      {url: "images/12.jpg", text: "æˆ‘ä»¬å¤©ä¸‹ç¬¬ä¸€å¥½ï¼ã€‚"},
      {url: "images/13.jpg", text: "æœ€å¥½çš„å¤è£…åŒäººç»„ã€‚"},
    ];

    /* æ˜¾ç¤ºé€Ÿåº¦ */
    let ti=0, ci=0;
    const titleEl = document.getElementById("title-header");
    const contentEl = document.getElementById("content");
    function typeTitle(){
      if(ti <= TITLE.length){
        titleEl.textContent = TITLE.slice(0, ti++);
        setTimeout(typeTitle, 120);
      } else typeContent();
    }
    function typeContent(){
      if(ci <= MESSAGE.length){
        contentEl.textContent = MESSAGE.slice(0, ci++);
        setTimeout(typeContent, 45);
      }
    }
    typeTitle();

    /* ç‹¬ç«‹çš„éŸ³ä¹æ§åˆ¶é€»è¾‘ */
    const bgm = document.getElementById("bgm");
    const musicBtn = document.getElementById("music");
    let musicOn = false;        // è®°å½•éŸ³ä¹æ˜¯å¦åœ¨æ’­æ”¾
    let hasStartedMusic = false; // è®°å½•æ˜¯å¦å·²ç»è§¦å‘è¿‡åˆæ¬¡è‡ªåŠ¨æ’­æ”¾

    // æŒ‰é’®ä¸“ç”¨æ§åˆ¶å‡½æ•°
    function toggleMusic() {
        if (musicOn) {
            bgm.pause();
            musicBtn.textContent = "ğŸµ æ’­æ”¾";
        } else {
            bgm.play();
            musicBtn.textContent = "â¸ æš‚åœ";
        }
        musicOn = !musicOn;
    }

    // æ‰‹åŠ¨åˆ‡æ¢éŸ³ä¹
    musicBtn.onclick = (e) => {
        e.stopPropagation();
        hasStartedMusic = true;
        toggleMusic();
    }

    /* Three.js å¼•æ“*/
    const scene=new THREE.Scene();
    const camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,.1,1000);
    camera.position.z=100;
    const renderer=new THREE.WebGLRenderer({antialias:true, alpha:true});
    renderer.setSize(innerWidth,innerHeight);
    renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
    document.body.appendChild(renderer.domElement);
    const HEART_COUNT = 15;
    const POINTS = 500;
    const HEART_SCALE = 5.0;
    const COLLISION_DIST = 40;
    function randomHeart(){
      let x,y; do{ x=(Math.random()*2-1)*16; y=(Math.random()*2-1)*16; }
      while(Math.pow(x*x+y*y-1,3)-x*x*y*y*y>0); return{x,y};
    }
    const groups=[];
    let exploded=false;
    for(let h=0; h<HEART_COUNT; h++){
      const pos=new Float32Array(POINTS*3); const vel=new Float32Array(POINTS*3);
      const heartArr=new Float32Array(POINTS*3); const explodeArr=new Float32Array(POINTS*3);
      const col=new Float32Array(POINTS*3); const c = new THREE.Color();
      for(let i=0;i<POINTS;i++){
        const i3=i*3; const p=randomHeart();
        heartArr[i3]=p.x*HEART_SCALE; heartArr[i3+1]=p.y*HEART_SCALE; heartArr[i3+2]=(Math.random()-.5)*5;
        explodeArr[i3]=(Math.random()-.5)*600; explodeArr[i3+1]=(Math.random()-.5)*600; explodeArr[i3+2]=(Math.random()-.5)*600;
        pos[i3]=explodeArr[i3]; pos[i3+1]=explodeArr[i3+1]; pos[i3+2]=explodeArr[i3+2];
        c.setHSL(0.97 + Math.random()*0.03, 0.8, 0.45); col[i3]=c.r; col[i3+1]=c.g; col[i3+2]=c.b;
      }
      const geo=new THREE.BufferGeometry();
      geo.setAttribute("position",new THREE.BufferAttribute(pos,3));
      geo.setAttribute("color",new THREE.BufferAttribute(col,3));
      const pts=new THREE.Points(geo, new THREE.PointsMaterial({size: 0.85, vertexColors:true, transparent:true, opacity: 0.8}));
      scene.add(pts);
      groups.push({pts, pos, vel, heartArr, explodeArr, center: new THREE.Vector3((Math.random()-.5)*130, (Math.random()*-60)-10, 0), cVel: new THREE.Vector3((Math.random()-0.5)*0.1, (Math.random()-0.5)*0.1, 0), fx:Math.random()*10, fy:Math.random()*10});
    }

    /* å±å¹•ç‚¹å‡»ä¸éŸ³ä¹è§£ç»‘ */
    const card = document.getElementById("card");
    const cardImg = document.getElementById("card-img");
    const cardText = document.getElementById("card-text");
    let photoIndex = 0;

    window.addEventListener("pointerdown",(e)=>{
      if(e.target.id === 'music') return;

      // åˆæ¬¡ç‚¹å‡»å±å¹•ï¼ŒåŒæ­¥å¯åŠ¨éŸ³ä¹
      if(!hasStartedMusic){
          bgm.play();
          musicOn = true;
          musicBtn.textContent = "â¸ æš‚åœ";
          hasStartedMusic = true; // ä¸ä¼šå¹²æ‰°éŸ³ä¹
      }

      exploded = !exploded;

      if(exploded){
        const p = PHOTOS[photoIndex % PHOTOS.length];
        cardImg.src = p.url;
        cardText.textContent = p.text;
        card.classList.add("active");
        photoIndex++;
      } else {
        card.classList.remove("active");
      }
    });

    function animate(){
      requestAnimationFrame(animate);
      let t = performance.now() * 0.001;
      if(!exploded){
        for(let i=0; i<groups.length; i++){
          for(let j=i+1; j<groups.length; j++){
            let d = groups[i].center.distanceTo(groups[j].center);
            if(d < COLLISION_DIST){
              let push = new THREE.Vector3().subVectors(groups[i].center, groups[j].center).normalize().multiplyScalar(0.012);
              groups[i].cVel.add(push); groups[j].cVel.sub(push);
            }
          }
          if(Math.abs(groups[i].center.x) > 95) groups[i].cVel.x *= -0.5;
          if(groups[i].center.y > 50 || groups[i].center.y < -80) groups[i].cVel.y *= -0.5;
          groups[i].center.add(groups[i].cVel); groups[i].cVel.multiplyScalar(0.97);
        }
      }
      groups.forEach((g)=>{
        const fx=Math.cos(t+g.fx)*1.8; const fy=Math.sin(t+g.fy)*1.2;
        for(let i=0;i<POINTS;i++){
          const i3=i*3;
          let tx = exploded ? g.explodeArr[i3] : (g.center.x + g.heartArr[i3] + fx);
          let ty = exploded ? g.explodeArr[i3+1] : (g.center.y + g.heartArr[i3+1] + fy);
          let tz = exploded ? g.explodeArr[i3+2] : (g.center.z + g.heartArr[i3+2]);
          g.vel[i3] += (tx - g.pos[i3]) * 0.0035; g.vel[i3+1] += (ty - g.pos[i3+1]) * 0.0035; g.vel[i3+2] += (tz - g.pos[i3+2]) * 0.0035;
          g.vel[i3]*=.91; g.vel[i3+1]*=.91; g.vel[i3+2]*=.91;
          g.pos[i3]+=g.vel[i3]; g.pos[i3+1]+=g.vel[i3+1]; g.pos[i3+2]+=g.vel[i3+2];
        }
        g.pts.geometry.attributes.position.needsUpdate=true;
      });
      renderer.render(scene,camera);
    }
    animate();
    window.addEventListener("resize",()=>{
      camera.aspect=innerWidth/innerHeight; camera.updateProjectionMatrix(); renderer.setSize(innerWidth,innerHeight);
    });
</script>
</body>
</html>